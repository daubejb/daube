<link rel="stylesheet" href="../shared.css">
<template id="daube-input-text">
  <style>
    :host {
      font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    }
    #inputdiv {
      margin: 20px;
      padding: 10px 10px 20px 10px;
      display: flex;
      flex-flow: column wrap;
      position: relative;
      max-width: 720px;
    }
    /* State - idle + empty */
    input {
      background-color: rgba(0,0,0,0);
      font-size: 16px;
      padding: 0px;
      padding-bottom: 8px;
      margin: 0;
      border: none;
      border-bottom: 1px solid rgba(0,0,0,0.42);
      width: 100%;
    }
    input:focus {
      outline:none;
    }
    label {
      position: absolute;
      top: 10px;
      background-color: rgba(0,0,0,0);
      font-size: 16px;
      color: rgba(0,0,0,0.54);
      font-weight: normal;
      z-index: 1;
      pointer-events: none;
    }
    ::-webkit-input-placeholder { /* Chrome/Opera/Safari */
      color: rgba(0,0,0,0);
    }
    ::-moz-placeholder { /* Firefox 19+ */
      color: rgba(0,0,0,0);
    }
    :-ms-input-placeholder { /* IE 10+ */
      color: rgba(0,0,0,0);
    }
    :-moz-placeholder { /* Firefox 18- */
      color: rgba(0,0,0,0);
    }
    /* State - hover */
    input:hover {
      border-bottom: 2px solid rgba(0,0,0,0.87);
    }
    /* State - focus */
    input:focus {
      border-bottom: 2px solid var(--pri-color);
      color: rgba(0,0,0,.87);
    }
    input:valid {
      color: var(--pri-color);
      opacity: 0.87;
    }
    input:focus + label, input:valid + label {
      transform: translateY(-25px);
      color: var(--pri-color);
      opacity: 0.87;
      font-size: 14px;
    }
    /* TODO State - error */
    /* TODO State - disabled */
    input:disabled, label:disabled {
      border-bottom: 1px dotted rgba(0,0,0,0.42);
    }
  </style>
  <div id="inputdiv">
    <input type="text" name="demo" />
    <label for="demo">Demo Label:</label>
  </div>
</template>

<script>
  (function() {
    let thisImportDoc = document.currentScript.ownerDocument;

    class DaubeInputText extends HTMLElement {
      static get observedAttributes() {
        //TODO - implement autocomplete
        //TODO - implement autofocus
        //TODO - implement form
        //TODO - implement inputmode
        //TODO - figure out required
        //TODO - implement pattern
        //TODO - implement value
        //TODO - implement Helper text
        return ['label', 'disabled', 'name', 'required'];
      }
      
      get name() {
        return this._name;
      }

      set name(v) {
        if (this._name === v) return;
        this._name = v;
        this.setAttribute('name', v);
      }

       get label() {
        return this._label;
      }

      set label(v) {
        if (this._label === v) return;
        if (v) {
          this.setAttribute('label', v);
        } else {
          this.removeAttribute('label');
        }
      }

      get disabled() {
        return this.hasAttribute('disabled');
      }

      set disabled(v) {
        if (v) {
          this.setAttribute('disabled', '');
        } else {
          this.removeAttribute('disabled');
        }
      }

      get required() {
        return this.hasAttribute('required');
      }

      set required(v) {
        if (v) {
          this.setAttribute('required', '');
        } else {
          this.removeAttribute('required');
        }
      }
      attributeChangedCallback (atrValue, oldValue, newValue) {
        if (atrValue === 'disabled') {
          this.toggleDisabled();
          console.log('disabled changed');
          }
        if (atrValue === 'required') {
          this.toggleRequired();
          console.log('required changed');
          }
        if (atrValue === 'name') {
          this.processName();
          console.log('name changed');
          }
        if (atrValue === 'label') {
          this.processLabel();
          console.log('label changed');
          }
      }

      constructor() {
        super();
        var shadowRoot = this.initShadowDom();
        var name = '';
      }


      static get template() {
        if (!this._template) {
          this._template = thisImportDoc.querySelector("#daube-input-text")
        }
        return this._template;
      }
      connectedCallback() {
        this.processName();
      }

      initShadowDom() {
        let shadowRoot = this.attachShadow({mode: 'open'});
        let tmpl = DaubeInputText.template;
        shadowRoot.appendChild(document.importNode(tmpl.content,true));
        return shadowRoot;
      }

      getLabel() {
        return this.shadowRoot.querySelector('label');
      }

      getInput() {
        return this.shadowRoot.querySelector('input');
      }

      toggleDisabled() {
        var label = this.getLabel();
        var input = this.getInput();
        if (this.disabled) {
          label.setAttribute('disabled', '');
          input.setAttribute('disabled', '');
        } else {
          label.removeAttribute('disabled');
          input.removeAttribute('disabled');
        }
      }

      toggleRequired() {
        var input = this.getInput();
        if (this.required) {
          input.setAttribute('required', '');
        } else {
          input.removeAttribute('required');
        }
      }

      processName() {
        var input = this.getInput();
        if (!this.hasAttribute('name')) {
          input.removeAttribute('name');
        } else {
        input.setAttribute('name', this.getAttribute('name'));
        }
      }

      processLabel() {
        var label = this.getLabel();
        label.innerHTML = this.getAttribute('label')
      }

    } // Class DaubeInputText
    customElements.define("daube-input-text", DaubeInputText)
  })();
</script>